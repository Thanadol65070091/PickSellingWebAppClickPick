<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ClickPick ‚Äì Products</title>
    <link rel="stylesheet" href="./assets/css/styles.css" />
  </head>
  <body>
    <header>
      <div>
        <a href="./" style="display: flex; flex-direction: row; align-items: center;">
          <img src="./images/logo.svg" style="width: 2rem; height: 2rem;"/>
          <strong style="font-size: 2rem;">ClickPick</strong>
        </a>
      </div>
      <div style="display: flex; flex-direction: row; align-items: center; gap: 1rem;">
        <a class="btn" href="./login">Log in</a>
        <img src="./images/pfp.png" style="width: 2rem; height: 2rem; border-radius: 999rem;"/>
        <a href="./cart">
          <img src="./images/cart.svg" style="width: 1.5rem; height: 1.5rem;"/>
        </a>
      </div>
    </header>
    <div class="container">
      <div style="display: flex; width: 100%; gap:12rem;">
        <h2 style="width: fit-content; margin:0px;">Products</h2>
        <div class="decor-input" style="width: 100%;">
          <input id="q" placeholder="Search" style="border:none !important; background-color: transparent;" />
          <button class="btn" id="searchBtn" style="background: none;">
            üîç
          </button>
        </div>
      </div>
      <div style="display: flex; flex-direction: row; width: 100%;">
        <form id="filter-form" class="filters" style="width: 20%;">
          <label><input type="radio" name="cate" value="all" checked> All</label>
          <label><input type="radio" name="cate" value="preset"> Preset</label>
          <label><input type="radio" name="cate" value="gadget"> Gadget</label>
          <label><input type="radio" name="cate" value="custompick"> Custom Pick</label>
        </form>
        <div style="width: 80%;">
          <div id="grid" class="grid" style="margin-top:16px;"></div>
        </div>
      </div>
    </div>
  </body>
</html>

<script type="module">
  import { products } from './assets/js/api.js';

  const grid = document.getElementById('grid');

  async function load(category, q) {
    if (!category || category === 'all') {
      category = '';
    }
    if (!q){
      q = '';
    }
    const list = await products.list({ q, category });
    grid.innerHTML = list.map(p => `
      <div class="card">
        <img src="./images/products/${getImage(p.category)}" alt="${p.category}" style="width:100%;height:140px;object-fit:cover;border-radius:6px" />
        <h3 style="margin-top:0px">${p.name}</h3>
        <p style="margin-top:0px">${p.description}</p>
        <p style="margin-top:0px"><strong>${p.price} THB</strong></p>
        <a class="btn" style="margin-top:0px; display:block; text-align:center;" href="./product?id=${p.id}">View</a>
      </div>
    `).join('');
  }
  
  const getImage = (category) => {
    if (category === "gadget"){
      const imgToRandom = [
        "amp.jpg", "capo.jpg", "pedal.jpg", "strap.jpg", "string.jpg"
      ]
      const randomIndex = Math.floor(Math.random() * imgToRandom.length);
      const img = imgToRandom[randomIndex]
      return img
    }else{
      return "pick.jpg"
    }
  }

  const form = document.getElementById('filter-form')
  form.addEventListener('change', () => {
    const cate = new FormData(form).get('cate')
    const text = inputField.value;
    load(cate, text);
  })

  const inputField = document.getElementById('q')
  inputField.addEventListener('change', () => {
    const cate = new FormData(form).get('cate')
    const text = inputField.value;
    console.log(cate, text)
    load(cate, text);
  })

  document.getElementById('searchBtn').addEventListener('click', load);
  load();

</script>

<!-- button => onclick(change some temp value contain category and call load) -->
